- job:
    name: designate-core
    parent: devstack-tempest
    nodeset: openstack-single-node-noble
    vars: &base_vars
      devstack_localrc:
        DESIGNATE_SERVICE_PORT_DNS: 5322
        TEMPEST_PLUGINS: /opt/stack/designate-tempest-plugin
        API_WORKERS: 2
      devstack_plugins:
        designate: https://opendev.org/openstack/designate
        designate-tempest-plugin: https://opendev.org/openstack/designate-tempest-plugin.git
      devstack_services:
        designate: true
        s-account: false
        s-container: false
        s-object: false
        s-proxy: false
        cinder: false
        c-api: false
        c-bak: false
        c-vol: false
      tox_envlist: all
      tempest_test_regex: |
        designate_tempest_plugin.*
    required-projects: &base_required_projects
      - openstack/designate
      - openstack/designate-dashboard
      - openstack/designate-tempest-plugin
      - openstack/python-designateclient
    timeout: 4200
    irrelevant-files: &base_irrelevant_files
      - ^.*\.rst$
      - ^api-ref/.*$
      - ^doc/.*$
      - ^releasenotes/.*$

- job:
    name: designate-bind9-core
    post-run: playbooks/designate-bind9/post.yaml
    parent: designate-core

- job:
    name: designate-bind9-with-keystone-default-roles
    post-run: playbooks/designate-bind9/post.yaml
    parent: designate-core
    nodeset: openstack-single-node-noble
    vars:
      devstack_local_conf:
        post-config:
          $DESIGNATE_CONF:
            oslo_policy:
              enforce_new_defaults: False
              enforce_scope: False
        test-config:
          "$TEMPEST_CONFIG":
            dns_feature_enabled:
              enforce_new_defaults: False
            enforce_scope:
              designate: False

- job:
    name: designate-bind9-core-catalog-zones
    parent: designate-bind9-core
    vars:
      devstack_localrc:
        DESIGNATE_USE_CATALOG_ZONES: true

- job:
    name: designate-pdns4-core
    post-run: playbooks/designate-pdns4/post.yaml
    parent: designate-core
    vars:
      devstack_localrc:
        DESIGNATE_BACKEND_DRIVER: pdns4

- job:
    name: designate-pdns4-postgres-core
    parent: designate-pdns4-core
    vars:
      devstack_services:
        mysql: False
        postgresql: True
    voting: false

- job:
    name: designate-bind9-stable-2024-1
    parent: designate-bind9-core
    nodeset: openstack-single-node-jammy
    override-checkout: stable/2024.1

- job:
    name: designate-bind9-stable-2024-2
    parent: designate-bind9-core
    nodeset: openstack-single-node-jammy
    override-checkout: stable/2024.2

- job:
    name: designate-bind9-stable-2025-1
    parent: designate-bind9-core
    nodeset: openstack-single-node-noble
    override-checkout: stable/2025.1

- job:
    name: designate-bind9-multipool
    parent: designate-core
    nodeset: openstack-single-node-noble
    vars:
      devstack_localrc:
        DESIGNATE_BACKEND_DRIVER: multipool-bind9
      devstack_local_conf:
        post-config:
          "$DESIGNATE_CONF":
            service:central:
              scheduler_filters: "pool_id_attribute, in_doubt_default_pool"
        test-config:
          "$TEMPEST_CONFIG":
            dns_feature_enabled:
              test_multipool_with_delete_opt: True
      tempest_test_regex: ^designate_tempest_plugin.tests.scenario.v2.test_designate_multipool.DesignateMultiPoolTest

# IPv6
- job:
    name: designate-core-only-ipv6
    parent: devstack-tempest-ipv6
    nodeset: openstack-single-node-noble
    description: |
      Designate devstack-tempest base job for IPv6-only deployment
    irrelevant-files: *base_irrelevant_files
    required-projects: *base_required_projects
    vars: *base_vars

- job:
    name: designate-only-ipv6-bind9
    post-run: playbooks/designate-bind9/post.yaml
    parent: designate-core-only-ipv6

- job:
    name: designate-only-ipv6-pdns4
    post-run: playbooks/designate-pdns4/post.yaml
    parent: designate-core-only-ipv6
    vars:
      devstack_localrc:
        DESIGNATE_BACKEND_DRIVER: pdns4
